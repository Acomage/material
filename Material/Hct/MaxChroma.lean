module
/- public import Material.Hct.HctSolver -/

def findPeak (fn : Float → Float) : (Float × Float) := Id.run do
  let mut a := 0.5
  let mut b := 98.5
  let phi : Float := (Float.sqrt 5.0 - 1.0) / 2.0
  let mut c := b - phi * (b - a)
  let mut d := a + phi * (b - a)
  let mut fc := fn c
  let mut fd := fn d
  while (b - a) > 0.0001 do
    if fc < fd then
      a := c
      c := d
      fc := fd
      d := a + phi * (b - a)
      fd := fn d
    else
      b := d
      d := c
      fd := fc
      c := b - phi * (b - a)
      fc := fn c
  let peakTone := (a + b) / 2.0
  return (peakTone, fn peakTone)


-- a precomputed table of Peak value of maxChroma hue
-- the fst of pair is which tone makes the peak
-- the snd of pair is the peak chroma value
/- public def maxChromaPeak : Array (Float × Float) := -/
/-   let maxChromaFn := (Array.range 720).map (HctSolver.maxChroma ∘ (·/2) ∘ Nat.toFloat) -/
/-   maxChromaFn.map findPeak -/

/- #eval maxChromaPeak -/

-- precomputed table of maxChroma peak values for each hue (0 to 359.5 by 0.5)
-- by the code commented out above
public def maxChromaPeak :=
  #[(55.157391, 102.535242), (55.120410, 102.558205), (55.037083, 102.597208), (54.978658, 102.635915),
  (54.921383, 102.679823), (54.865242, 102.728977), (54.835081, 102.775216), (54.781383, 102.834157),
  (54.703451, 102.908441), (54.651623, 102.912763), (54.600878, 102.984901), (54.551217, 103.137167),
  (54.502480, 103.145372), (54.454794, 103.233821), (54.381502, 103.384826), (54.362428, 103.521725),
  (54.263413, 103.466374), (54.273863, 103.749397), (54.230988, 103.872361), (54.216226, 103.972560),
  (54.147969, 104.137040), (54.080040, 104.245213), (54.096193, 104.321761), (54.002128, 104.547804),
  (54.020565, 104.698974), (53.984031, 104.863411), (53.891665, 105.052157), (53.885101, 105.269152),
  (53.850871, 105.458583), (53.817481, 105.655046), (53.813562, 105.787296), (53.635191, 105.925098),
  (53.663356, 106.217032), (53.662358, 106.480245), (53.662082, 106.482363), (53.633300, 106.994004),
  (53.634554, 107.133752), (53.518217, 107.430218), (53.399576, 107.240359), (53.465274, 107.974255),
  (53.470085, 108.297605), (53.475480, 108.235353), (53.329449, 108.780408), (53.398185, 109.210131),
  (53.283016, 109.416781), (53.353610, 109.866683), (53.362733, 110.249144), (53.280817, 110.525356),
  (53.322163, 110.968401), (53.302813, 111.344541), (53.284046, 111.732727), (52.459048, 111.066503),
  (53.248372, 112.543850), (53.232855, 112.930442), (53.245760, 112.607473), (53.232855, 113.076349),
  (53.487269, 111.288582), (53.939128, 109.702263), (54.294276, 108.058292), (54.735705, 106.062830),
  (54.987782, 104.946716), (55.326501, 103.473299), (55.660100, 102.051221), (55.894855, 100.568750),
  (56.312759, 99.350811), (56.632128, 98.068108), (56.947046, 96.827744), (57.257705, 95.627669),
  (57.564222, 94.466214), (57.866768, 93.341600), (58.165395, 92.252561), (58.460346, 91.197212),
  (58.751655, 90.174499), (59.039458, 89.183051), (59.323907, 88.221519), (59.605094, 87.288808),
  (59.883138, 86.383788), (60.058673, 85.413383), (60.430146, 84.652925), (60.699268, 83.430961),
  (60.562190, 82.661970), (61.229421, 82.240591), (61.490588, 81.482031), (61.647739, 80.658098),
  (62.005480, 80.028877), (62.157183, 79.247525), (62.510992, 78.656385), (62.657608, 77.914829),
  (63.007754, 77.359449), (63.149559, 76.313256), (63.496371, 76.133415), (63.737794, 75.545675),
  (63.977360, 74.974184), (64.215121, 74.418504), (64.240864, 73.718953), (64.685628, 73.352463),
  (64.918440, 72.841399), (65.149722, 72.344404), (65.379475, 71.564060), (65.607857, 71.391292),
  (65.834827, 70.934461), (66.060491, 70.490299), (66.284881, 70.058532), (66.507985, 69.365040),
  (66.513656, 69.082235), (66.950826, 68.834824), (67.170595, 68.449805), (67.389314, 68.075837),
  (67.607023, 67.461281), (67.604633, 67.215237), (68.039722, 67.017691), (68.254733, 66.685520),
  (68.468916, 66.363274), (68.682345, 66.050711), (68.895052, 65.747656), (69.107004, 65.233155),
  (69.318372, 65.169477), (69.529083, 64.893985), (69.402455, 64.418806), (69.948793, 64.165490),
  (70.157910, 64.119958), (70.366560, 63.878921), (70.574764, 63.646173), (70.669244, 63.353579),
  (70.990024, 63.204972), (70.969144, 62.860994), (71.404010, 62.620330), (71.496238, 62.534953),
  (71.817051, 62.416343), (72.023279, 62.238094), (72.229369, 61.908274), (72.435374, 61.903577),
  (72.641294, 61.747142), (72.847214, 61.597781), (73.053082, 61.455477), (73.259034, 61.320081),
  (73.465039, 61.191567), (73.671150, 61.069854), (73.877411, 60.954869), (74.083830, 60.846567),
  (74.290452, 60.624765), (74.497370, 60.649728), (74.704576, 60.561080), (74.912078, 60.478897),
  (75.119921, 60.403129), (75.328177, 60.333718), (75.536880, 60.270628), (75.746029, 60.213832),
  (75.955677, 60.163290), (76.045484, 60.054605), (76.376641, 59.997508), (76.588041, 59.969105),
  (76.800131, 60.023051), (77.012891, 60.003354), (77.226405, 59.989761), (77.440674, 59.982259),
  (77.777745, 59.982713), (77.994010, 59.990772), (78.211167, 59.611693), (78.429269, 59.630147),
  (78.648316, 60.051185), (78.868447, 60.083397), (79.089661, 60.121648), (79.312010, 60.165947),
  (79.535508, 60.216292), (79.760279, 60.272714), (79.986304, 59.930170), (80.213635, 60.403794),
  (80.442357, 60.071081), (80.672471, 60.559321), (80.904082, 60.646310), (81.137255, 60.739495),
  (81.372009, 60.838894), (81.608379, 60.944525), (81.846500, 61.056462), (82.086375, 61.174716),
  (82.328074, 61.299332), (82.571729, 61.015264), (82.817275, 61.567872), (83.064849, 61.711863),
  (83.314589, 61.445862), (83.566442, 62.019647), (83.820527, 62.183512), (84.076969, 62.354151),
  (84.335799, 62.113913), (84.597085, 62.715933), (84.860950, 62.489382), (85.127408, 63.105561),
  (85.396636, 63.311037), (85.668732, 63.106121), (85.943696, 63.743769), (86.221687, 63.971187),
  (86.502769, 64.206094), (86.787100, 64.448641), (87.074766, 64.698920), (87.365851, 64.957024),
  (87.660527, 65.223123), (87.958845, 65.496678), (88.260997, 65.778207), (88.567101, 65.657720),
  (88.877208, 66.366238), (89.191595, 66.266693), (89.510294, 66.988633), (89.833496, 67.313077),
  (90.161371, 67.646604), (90.494111, 67.989420), (90.734451, 68.291459), (91.174712, 68.703510),
  (91.523021, 68.687314), (91.876843, 69.457028), (92.236441, 69.849076), (92.602072, 70.251692),
  (92.973872, 70.665027), (93.352132, 71.089396), (93.737092, 71.525064), (94.129050, 71.610476),
  (94.528189, 72.073960), (94.898132, 72.860069), (95.349289, 73.038279), (95.771867, 73.883145),
  (96.202899, 74.392957), (96.642767, 74.583300), (97.091758, 75.453687), (97.016267, 75.719151),
  (96.876386, 75.957314), (96.744394, 76.207009), (96.608293, 76.455396), (96.468793, 76.722218),
  (96.323654, 76.986851), (96.189995, 77.253072), (96.062953, 77.555272), (95.920150, 77.844138),
  (95.733390, 78.116292), (95.637210, 78.446985), (95.514703, 78.771041), (95.377041, 79.094734),
  (95.239070, 79.426579), (95.059956, 79.743224), (94.962162, 80.115030), (94.823173, 80.471876),
  (94.659649, 80.823153), (94.531386, 81.203819), (94.403877, 81.594068), (94.263208, 81.985901),
  (94.122073, 82.386769), (93.949766, 82.778335), (93.806347, 83.196733), (93.645468, 83.614412),
  (93.500244, 84.051542), (93.408462, 84.531893), (93.150301, 84.919587), (93.080344, 85.434652),
  (92.972960, 85.937472), (92.805963, 86.413944), (92.658041, 86.913445), (92.531032, 87.437862),
  (92.382164, 87.959967), (92.209497, 88.478403), (91.936816, 88.838827), (91.930528, 89.595004),
  (91.702784, 90.113465), (91.624871, 90.744829), (91.444366, 91.201659), (91.315243, 91.821750),
  (91.131424, 92.416969), (90.944992, 93.157794), (90.785143, 93.802925), (90.594209, 94.440828),
  (90.337905, 95.046846), (90.360038, 95.715189), (90.196599, 96.571797), (90.031854, 97.291169),
  (89.865750, 98.026197), (89.631409, 98.727607), (89.529230, 99.545057), (89.358762, 100.329537),
  (89.116052, 101.077007), (88.977306, 101.923051), (88.837923, 102.788549), (88.623825, 103.405381),
  (88.444541, 104.490306), (88.185454, 105.321936), (87.879574, 106.135691), (87.935406, 107.267764),
  (87.749197, 108.225801), (87.737015, 107.389116), (87.770746, 105.805278), (87.519169, 103.364341),
  (87.760402, 102.598594), (87.891724, 101.186708), (87.764045, 99.654280), (87.758682, 98.261809),
  (87.908239, 97.026688), (87.835085, 95.691922), (88.008284, 94.567602), (87.737015, 93.135376),
  (88.068756, 91.869228), (88.041005, 91.130292), (88.025297, 90.048912), (87.952728, 88.967969),
  (88.297564, 88.045155), (87.586927, 86.770950), (88.356645, 86.312681), (88.380478, 85.138362),
  (88.381784, 84.546340), (88.382868, 83.699570), (88.383813, 82.878851), (88.498397, 82.149673),
  (88.500425, 81.380500), (88.588873, 80.683214), (88.559539, 79.942124), (88.615647, 79.270856),
  (88.372470, 78.453538), (88.631885, 77.937223), (88.738409, 77.354452), (88.614957, 76.663063),
  (88.766181, 76.140435), (88.749581, 75.543805), (88.794103, 74.997146), (88.923502, 74.510951),
  (88.937936, 73.979499), (88.979610, 73.477515), (89.029495, 72.994390), (89.026797, 72.497221),
  (89.101788, 72.014505), (88.862531, 71.462980), (89.097870, 71.128695), (89.095533, 70.684611),
  (89.170768, 70.292170), (89.169409, 69.872147), (89.242563, 69.501002), (89.242116, 69.104275),
  (89.320836, 68.757343), (89.313741, 68.377877), (89.375414, 68.043089), (89.434974, 67.716513),
  (89.437140, 67.292392), (89.474843, 66.977367), (89.518886, 66.674513), (89.555591, 66.444975),
  (89.552670, 66.133147), (89.589650, 65.848713), (89.553031, 65.537463), (89.662358, 65.245696),
  (89.679955, 65.033925), (89.733568, 64.788673), (89.745633, 64.531006), (89.751973, 64.278239),
  (89.815951, 64.059263), (89.850542, 63.833680), (89.884825, 63.599257), (89.877231, 63.382234),
  (89.779417, 63.114896), (89.966485, 62.985343), (89.975970, 62.745973), (89.950023, 62.564968),
  (90.039140, 62.408015), (90.077066, 62.204911), (90.110128, 62.062794), (90.138739, 61.895333),
  (90.155083, 61.727757), (90.195877, 61.576598), (90.220570, 61.423601), (90.237945, 61.272323),
  (90.277761, 61.117495), (90.299395, 60.997015), (90.334899, 60.852627), (90.360261, 60.741164),
  (90.392037, 60.621042), (90.423517, 60.505579), (90.431492, 60.384091), (90.449037, 60.271456),
  (90.503563, 60.179770), (90.537261, 60.083118), (90.565682, 59.988690), (90.594176, 59.898380),
  (90.620536, 59.811478), (90.649180, 59.729714), (90.677845, 59.652113), (90.703004, 59.576977),
  (90.736926, 59.509816), (90.765570, 59.444307), (90.794287, 59.382690), (90.823036, 59.325022),
  (90.850650, 59.270808), (90.880653, 59.221345), (90.909541, 59.173483), (90.938513, 59.131449),
  (90.966902, 59.092841), (90.996682, 59.059256), (91.025878, 59.027990), (91.055126, 59.000401),
  (91.084460, 58.976432), (91.113846, 58.956045), (90.852954, 58.811891), (90.565788, 58.659595),
  (90.281095, 58.511727), (89.998740, 58.368179), (89.718636, 58.228874), (89.440783, 58.093781),
  (89.165097, 57.832881), (88.891418, 57.835897), (88.619821, 57.713003), (88.350114, 57.594025),
  (88.082350, 57.478958), (87.816371, 57.367703), (87.552145, 57.260378), (87.289639, 57.156954),
  (87.028780, 57.057326), (86.769522, 56.961449), (86.511775, 56.869261), (86.255524, 56.780731),
  (86.000697, 56.695809), (85.747281, 56.491897), (85.495119, 56.536627), (85.244296, 56.462294),
  (84.994662, 56.391402), (84.746260, 56.323939), (84.498962, 56.259848), (84.252748, 56.199105),
  (84.007596, 56.141684), (83.763389, 56.087539), (83.520180, 56.036661), (83.277916, 55.874300),
  (83.036460, 55.944577), (82.795864, 55.790318), (82.556022, 55.865213), (82.316955, 55.719016),
  (82.078557, 55.798391), (81.840829, 55.769631), (81.603738, 55.743948), (81.367231, 55.721324),
  (81.131275, 55.701742), (80.895798, 55.685185), (80.660820, 55.671643), (80.426236, 55.661098),
  (80.192086, 55.653543), (79.958276, 55.648964), (79.600102, 55.588671), (79.367237, 55.650623),
  (79.134564, 55.656484), (78.902113, 55.665278), (78.669833, 55.677001), (78.437691, 55.691647),
  (78.205634, 55.709213), (77.973662, 55.729693), (77.741710, 55.753086), (77.509738, 55.779394),
  (77.277734, 55.808613), (77.045624, 55.840748), (76.813397, 55.798122), (76.581084, 55.913754),
  (76.348528, 55.954641), (76.115749, 55.998452), (75.882714, 56.045193), (75.649404, 56.094867),
  (75.415732, 56.147490), (75.181699, 56.203064), (74.947253, 56.261601), (74.712360, 56.323111),
  (74.476989, 56.387602), (74.241098, 56.455088), (74.004591, 56.430405), (73.767552, 56.599114),
  (73.529877, 56.675665), (73.291479, 56.655926), (73.052412, 56.837959), (72.812571, 56.923728),
  (72.571922, 57.012607), (72.330433, 57.104615), (72.088064, 57.199772), (71.844802, 57.298086),
  (71.600530, 57.399613), (71.355241, 57.394389), (71.108920, 57.501098), (70.861537, 57.723577),
  (70.612965, 57.838129), (70.363225, 57.955995), (70.112232, 58.077223), (69.859932, 58.201847),
  (69.606294, 58.329891), (69.351296, 58.461372), (69.094855, 58.596342), (68.836936, 58.734826),
  (68.577436, 58.753653), (68.316406, 59.022512), (68.053677, 59.171797), (67.789227, 59.198210),
  (67.523078, 59.481407), (67.255071, 59.641831), (66.985141, 59.806082), (66.713320, 59.974148),
  (66.439472, 60.146121), (66.163562, 60.322031), (65.885466, 60.501964), (65.605192, 60.685923),
  (65.322666, 60.873961), (65.037783, 61.066155), (64.750446, 61.262577), (64.460666, 61.463223),
  (64.168242, 61.529033), (63.873206, 61.737552), (63.575471, 62.091382), (63.274849, 62.168027),
  (62.971358, 62.390110), (62.664893, 62.760070), (62.355318, 62.848286), (62.042598, 63.229215),
  (61.726597, 63.470997), (61.407175, 63.571620), (61.084334, 63.969371), (60.757903, 64.226079),
  (60.427724, 64.339948), (60.093816, 64.754974), (59.755937, 65.027308), (59.414022, 65.155284),
  (59.067965, 65.437868), (58.717648, 65.876688), (58.362860, 66.170912), (58.003538, 66.470791),
  (57.639489, 66.776448), (57.270609, 67.087934), (56.706365, 67.261268), (56.517682, 67.728773),
  (56.133338, 68.058274), (55.743513, 68.393944), (55.348017, 68.735879), (54.946660, 69.084170),
  (54.539343, 69.438819), (54.125750, 69.800011), (53.705785, 70.167731), (53.279183, 70.542101),
  (52.935206, 70.892657), (52.405224, 71.156201), (51.957454, 71.705703), (51.502176, 72.107231),
  (51.039059, 72.515744), (50.654440, 72.912433), (50.174363, 73.278052), (49.600528, 73.783144),
  (49.103661, 74.219669), (48.681529, 74.589766), (48.165384, 75.106209), (47.556905, 75.571291),
  (47.103326, 76.032481), (46.556745, 76.505889), (45.999372, 76.985977), (45.351130, 77.469813),
  (44.850587, 77.965813), (44.258486, 78.465140), (43.576630, 78.961881), (43.036665, 79.408206),
  (42.406191, 79.998073), (41.762039, 80.519597), (41.103813, 81.045699), (40.430996, 81.501561),
  (39.743214, 82.109639), (39.039895, 82.646261), (38.320613, 83.185015), (37.584849, 83.725096),
  (36.832144, 84.192959), (36.062065, 84.805295), (35.274080, 85.343201), (34.467709, 85.877978),
  (33.642553, 86.408153), (32.798171, 86.932148), (32.375403, 87.229564), (32.548963, 87.229016),
  (32.725188, 87.230435), (32.898355, 87.236935), (33.074527, 87.245416), (33.251698, 87.254151),
  (33.429846, 87.271468), (33.609045, 87.289060), (33.789306, 87.309710), (33.970619, 87.333427),
  (34.153046, 87.360229), (34.336557, 87.390120), (34.521204, 87.423119), (34.706999, 87.459236),
  (34.893983, 87.498490), (35.082167, 87.540893), (35.271520, 87.586449), (35.462146, 87.635192),
  (35.654026, 87.687128), (35.847159, 87.742266), (36.041599, 87.800632), (36.237398, 87.862253),
  (36.434535, 87.927133), (36.633031, 87.995289), (36.832919, 88.066742), (37.034284, 88.116846),
  (37.237040, 88.219648), (37.441292, 88.301130), (37.647074, 88.386006), (37.854353, 88.474275),
  (38.063227, 88.565989), (38.273649, 88.661140), (38.485719, 88.759783), (38.699424, 88.823164),
  (38.914776, 88.967581), (39.131848, 89.076800), (39.350639, 89.189592), (39.571216, 89.306004),
  (39.793598, 89.426057), (40.017818, 89.549782), (40.243895, 89.677201), (40.471843, 89.808333),
  (40.701734, 89.943231), (40.933620, 90.081938), (41.167462, 90.224442), (41.403385, 90.370832),
  (41.641389, 90.452785), (41.881454, 90.675306), (42.123718, 90.833488), (42.368128, 90.995645),
  (42.614809, 91.161872), (42.863742, 91.332169), (43.066550, 91.472766), (43.368564, 91.685155),
  (43.574103, 91.855772), (43.831543, 92.043512), (44.143954, 92.246337), (44.353943, 92.431965),
  (44.618976, 92.632758), (44.942093, 92.740069), (45.156966, 93.047729), (45.487454, 93.269015),
  (45.705832, 93.480871), (45.984492, 93.704404), (46.266040, 93.932651), (46.550489, 94.165635),
  (46.900242, 94.406280), (47.191721, 94.648101), (47.486259, 94.894809), (47.783961, 95.146504),
  (48.084892, 95.403254), (48.321983, 95.607142), (48.628533, 95.934882), (48.938522, 96.143736),
  (49.251944, 96.486719), (49.568910, 96.770697), (49.961157, 97.053051), (50.286302, 97.346922),
  (50.541660, 97.655735), (50.947809, 97.951480), (51.209115, 98.274153), (51.624768, 98.578994),
  (51.892361, 98.915982), (52.240118, 99.245905), (52.592070, 99.581950), (53.027605, 99.905668),
  (53.308877, 100.272860), (53.673871, 100.628228), (54.043473, 100.886674), (54.417643, 101.251974),
  (54.796486, 101.733689), (55.180193, 102.115624), (55.568817, 102.504469), (55.962390, 102.900268),
  (56.361115, 103.303237), (56.765032, 103.713432), (57.174260, 104.130984), (57.588915, 104.556025),
  (58.009104, 104.988678), (58.434931, 105.429063), (58.866568, 105.877370), (59.304078, 106.333681),
  (59.747621, 106.650084), (60.287363, 107.213942), (60.207731, 107.240506), (60.056389, 106.971372),
  (59.907745, 106.817778), (59.761746, 106.614488), (59.618412, 106.416601), (59.477606, 106.223939),
  (59.339339, 106.036531), (59.203534, 105.854284), (59.070131, 105.677131), (58.939117, 105.505068),
  (58.810460, 105.338064), (58.684034, 105.175971), (58.559913, 105.018894), (58.437957, 104.866673),
  (58.318181, 104.719337), (58.200505, 104.576805), (58.084955, 104.439122), (57.971454, 104.306208),
  (57.859928, 104.177995), (57.750431, 104.054558), (57.642856, 103.935794), (57.537225, 103.821740),
  (57.433431, 103.712300), (57.331496, 103.607514), (57.231430, 103.507408), (57.133137, 103.379641),
  (57.036544, 103.320943), (56.941756, 103.234653), (56.848616, 103.152903), (56.757195, 103.075777),
  (56.667409, 103.003222), (56.579217, 102.935227), (56.492660, 102.871844), (56.407685, 102.813051),
  (56.324220, 102.758821), (56.242303, 102.709203), (56.161864, 102.664175), (56.082901, 102.623760),
  (56.005382, 102.587966), (55.929308, 102.556816), (55.854678, 102.530329), (55.781386, 102.508493),
  (55.709453, 102.491345), (55.638912, 102.478913), (55.569677, 102.464746), (55.479477, 102.468322),
  (55.412579, 102.471795), (55.346881, 102.449682), (55.282510, 102.493538), (55.219340, 102.511877)]
